import{j as s}from"./cm-1.0.43-BIThoEwM.js";import{r as m}from"./redux-1.0.43-X9ShETON.js";import{u as f,a as T}from"./hooks-1.0.43-Bzf6s8gj.js";import{l as u,A as R,V as H,W,X as z,Y as L,S as G,w as I,H as U,Z as V,e as X,_ as Y,$ as Z}from"./lib-1.0.43-GM4CAPbj.js";import{A as $}from"./AppContainerSelector-1.0.43-azpPHtXJ.js";import{B as x,S as q}from"./Spinner-1.0.43-YmZqinVQ.js";import{u as J,a as K}from"./useChartSettings-1.0.43-CyXaF5Yk.js";import{u as C}from"./useMetadata-1.0.43-5v27HTeK.js";import{u as Q}from"./useRemoveAppFromStore-1.0.43-BZ2w6e3F.js";import{u as D,B as ee,C as se}from"./useFormDetails-1.0.43-D5LxUh_w.js";import{f as te,H as pe,A as oe,T as ne,M as re}from"./index-1.0.43-Br_nYvvF.js";import{D as v}from"./DynamicModeEnum-1.0.43-BXuL5kgA.js";import{T as y}from"./Tooltip-1.0.43-Dw3sfo8K.js";import{I as g}from"./iconBase-1.0.43-BkINToSh.js";import{M as ie}from"./MenuItem-1.0.43-Uicrp-o6.js";import{M as ae}from"./Menu-1.0.43-TbmZ3Ge2.js";import{u as le}from"./useTableSettings-1.0.43-CCERpAbi.js";import{u as ce}from"./useStoreFormSettings-1.0.43-FA6xRyVh.js";import{u as me,A as ue}from"./AppTheme-1.0.43-C6ZTpO5w.js";import{T as de}from"./ThemeProvider-1.0.43-BdkGbeAu.js";import"./vendor-1.0.43-CN03Eozo.js";import"./loglevel-1.0.43-BZ7XahX3.js";import"./lodash-1.0.43-BGoSrRk7.js";import"./moment-1.0.43-C5S46NFB.js";import"./main-1.0.43.js";import"./FallbackSpinner-1.0.43-SRqLbyxS.js";import"./useLoadAppMetaData-1.0.43-CKfh6BSz.js";import"./ActionsApp-1.0.43-BtCNZ6dp.js";import"./RestApi-1.0.43-DDknciaN.js";import"./notistack-1.0.43-CFZ1B9cW.js";import"./StoreTypeEnum-1.0.43-DJ3XTTGQ.js";import"./MapPrepare-1.0.43-CGo0KOqr.js";import"./Typography-1.0.43-CjHjtdZs.js";import"./lang-1.0.43-B1WmIuB6.js";import"./useEnhancedEffect-1.0.43-DcXwKdLb.js";import"./useControlled-1.0.43-DObA-A1B.js";import"./Popper-1.0.43-8Yb3KIgh.js";import"./index-1.0.43-C6_8mZyP.js";import"./getThemeProps-1.0.43-5uxEwZ_e.js";const xe=()=>{const e=f(t=>t.appApps.modes);return u.debug("appModes",e),e},he=({appRootId:e,appId:t,appDbId:r,isVisible:a,fullScreen:o})=>{const[p,l]=m.useState(!1);return m.useEffect(()=>{a&&!p&&l(!0)},[a]),p?s.jsx(x,{className:"pp-apps-root"+(a?"":" pp-element-hide"),sx:{"& .pp-app-container .pp-component header.pp-header":{margin:0,visibility:"hidden",position:"absolute",left:-99999,top:-99999}},children:s.jsx($,{appId:t,appDbId:r,fullScreen:o,appRootId:e})}):null},fe=e=>{const t=f(r=>r.appApps.apps[e]!==void 0?r.appApps.apps[e].activeAppId??r.appApps.apps[e].apps[0]:0);return u.debug("activeAppId",t,e),t},ge=e=>{const t=f(r=>r.appApps.modes[e]);return u.debug("appMode",t),t},Ae=({appId:e})=>{const t=T(),r=D(e),a=C(e),o=ge(e);return s.jsx(y,{title:s.jsx(ee,{details:r,mode:o==null?void 0:o.mode}),className:"pp-builder-button",children:s.jsx(g,{sx:{color:"inherit",padding:0},onClick:()=>{var p,l;((l=(p=a==null?void 0:a.app)==null?void 0:p.app[0])==null?void 0:l.app_type)==R.CHART?t(H({appId:e})):(o==null?void 0:o.mode)===v.FORM?t(W({appId:e})):t(z({appId:e}))},children:s.jsx(te,{})})})},je=({appDbId:e,appTitle:t,setActiveApp:r,handleClose:a})=>s.jsx(ie,{onClick:()=>{r(e),a()},children:s.jsx("span",{children:t})}),Se=({apps:e,setActiveApp:t})=>{const[r,a]=m.useState(null),o=!!r,p=n=>{a(n.currentTarget),n.stopPropagation()},l=()=>{a(null)};return s.jsxs(x,{sx:{position:"relative"},children:[s.jsx(g,{sx:{color:"inherit",padding:0},onClick:p,children:s.jsx(pe,{})}),s.jsxs(ae,{anchorEl:r,open:o,onClose:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},sx:{marginTop:"8px","& ul":{padding:"0 !important"},"& ul li":{padding:"12px 24px 12px 18px !important"}},children:[...e.apps.map(n=>e.titles[n]===void 0?null:s.jsx(je,{appDbId:n,appTitle:e.titles[n],setActiveApp:t,handleClose:l}))]})]})},is=({appId:e})=>{var j,S,b,M;u.debug(e);const t=T(),r=Q(),a=se(),o=L.getSelectors().selectApps(G.getState().appApps,e),p=m.useMemo(()=>{const i={};return Array.isArray(o.apps)&&o.apps.length>0&&o.apps.map(h=>{i[h]=I()}),i},[]),l=J(e),n=C(e),F=m.useMemo(()=>{var i,h;return((h=(i=n==null?void 0:n.app)==null?void 0:i.app[0])==null?void 0:h.app_title)!==""?n.app.app[0].app_title:"WP Data Access"},[]),c=fe(e),E=i=>{t(Z({appId:e,activeAppId:i}))};K(p[c]);const B=le(p[c]),w=ce(p[c]),k=me(p[c]),O=ue(k,B,w),[d,be]=m.useState(((b=window.PP_APP_CONFIG[(S=(j=n==null?void 0:n.app)==null?void 0:j.app[0])==null?void 0:S.app_id])==null?void 0:b.appFullscreen)===!0);u.debug("appFullScreen",d);const A=xe();m.useEffect(()=>{u.debug("setFullScreen",p,d),Object.keys(p).map(i=>{t(U({appId:p[Number(i)],property:{fullScreen:d??!1}}))})},[A,d]);const P=((M=A[p[c]])==null?void 0:M.mode)??v.TABLE;u.debug("mode",P);let N={};const _=()=>null;return o===void 0||Object.keys(p).length===0?s.jsx(q,{}):s.jsx(de,{theme:O,children:s.jsxs(x,{className:"pp-apps-container",sx:{...d?N:{},"& .pp-element-hide":{visibility:"hidden",position:"absolute",left:-99999,top:-99999}},children:[s.jsx(oe,{className:"pp-apps-header",position:"relative",sx:{margin:"0 0 5px 0"},children:s.jsxs(ne,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center",gap:"5px","& span":{whiteSpace:"nowrap",fontSize:"18px",lineHeight:"18px",fontWeight:"bold"},"& span.pp-header-title":{minWidth:0,textOverflow:"ellipsis",overflow:"hidden",marginRight:"10px"}},children:[s.jsx("span",{children:s.jsx(Se,{apps:o,setActiveApp:E})}),s.jsxs("span",{className:"pp-header-title",children:[F," - ",o.titles[c]]})]}),s.jsxs(x,{sx:{display:"flex",gap:"10px",justifyContent:"center",alignItems:"center"},children:[V(n)&&s.jsx(Ae,{appId:p[c]}),_(),(n==null?void 0:n.isExploring)&&s.jsx(y,{title:l.close,children:s.jsx(g,{sx:{color:"inherit",padding:0},onClick:()=>{t(X({isActive:!1,appDbId:0})),a(e),r(e),t(Y()),Object.keys(p).map(i=>{a(p[i]),r(p[i])})},children:s.jsx(re,{})})})]})]})}),...o.apps.map(i=>s.jsx(he,{appRootId:e,appId:p[i],appDbId:i,isVisible:i===c,fullScreen:d}))]})})};export{is as default};
