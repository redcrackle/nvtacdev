import{r as l}from"./redux-1.0.43-X9ShETON.js";import{b as G}from"./ActionsApp-1.0.43-BtCNZ6dp.js";import{l as s,A as r,F as g,G as j,H as w,a as A}from"./lib-1.0.43-GM4CAPbj.js";import{e as S}from"./notistack-1.0.43-CFZ1B9cW.js";import{u as z,S as B,D as h}from"./StoreTypeEnum-1.0.43-DJ3XTTGQ.js";import{a as K}from"./hooks-1.0.43-Bzf6s8gj.js";const I=(t,a,L,b,H,Q,m,o)=>{const c=K(),{prepareAppStore:J,prepareApp:k}=z(t,B.APP),[x,i]=l.useState(!1),[R,u]=l.useState(),[q,y]=l.useState(""),D=e=>{var n,M,P,T,_,E,N,v,C,O;if(s.debug(e),e.app&&e.app.app&&Array.isArray(e.app.app)&&e.app.container&&Array.isArray(e.app.container)&&e.app.apps&&Array.isArray(e.app.apps))if(e.app.app[0].app_type==r.APPCONTAINER)k(e,m),u(r.APPCONTAINER),i(!0);else if(e.app.app[0].app_type==r.CHART){const p={...e};p.src=h(a,(M=(n=e==null?void 0:e.app)==null?void 0:n.container[0])==null?void 0:M.cnt_id),m===!0&&(p.isExploring=!0),o!==void 0&&(p.appRootId=o),c(g({appId:t,metaData:p})),u(r.CHART),i(!0)}else if(e.app.app[0].app_type==r.MAP){const p={...e};p.src=h(a,(T=(P=e==null?void 0:e.app)==null?void 0:P.container[0])==null?void 0:T.cnt_id),m===!0&&(p.isExploring=!0),o!==void 0&&(p.appRootId=o);let f={};try{((E=(_=e==null?void 0:e.app)==null?void 0:_.container[0])==null?void 0:E.cnt_map)!==void 0&&((v=(N=e==null?void 0:e.app)==null?void 0:N.container[0])==null?void 0:v.cnt_map)!==null&&(f=JSON.parse((O=(C=e==null?void 0:e.app)==null?void 0:C.container[0])==null?void 0:O.cnt_map),delete f.state)}catch(F){s.error("Invalid JSON - map settings"),s.error(F),S("Invalid JSON, check console",{variant:"error"})}c(j({appId:t,mapState:f})),c(g({appId:t,metaData:p})),u(r.MAP),i(!0)}else J(a,e,L===!0,void 0,o,()=>{})&&(c(w({appId:t,property:{staticFilter:b,shortcodeArgs:H}})),u(e.app.app[0].app_type),i(!0));else S(A.contactSupport,{variant:"error"}),y(A.contactSupport)};return{loadAppMetaData:()=>{G(a,e=>{const n=e==null?void 0:e.data;s.debug("response data",n),D(n)},e=>{s.error("error",e),S(e??A.contactSupport,{variant:"error"}),y(e??A.contactSupport)})},processMetaData:D,metaDataLoaded:x,loadError:q,appType:R}};export{I as u};
