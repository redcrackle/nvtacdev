import{j as e}from"./cm-1.0.43-BIThoEwM.js";import{l as d,i as F,R as k,A as B,a5 as L,al as D,G as R,cc as v}from"./lib-1.0.43-GM4CAPbj.js";import{u as w}from"./useStoreTable-1.0.43-L56KWd1n.js";import{a as C}from"./hooks-1.0.43-Bzf6s8gj.js";import{u as N}from"./useTableUpdater-1.0.43-C8DXp04q.js";import{u as P}from"./useMetadata-1.0.43-5v27HTeK.js";import{c as K,d as U,e as _}from"./settings-1.0.43-kDKJ-WYT.js";import{P as z}from"./PremiumFeature-1.0.43-BD8gtQwD.js";import{M as H,C as O}from"./MapsApiKey-1.0.43-kgtkXZS9.js";import{u as G}from"./useApp-1.0.43-trge1ckI.js";import{r as M}from"./redux-1.0.43-X9ShETON.js";import{A as J,a as q}from"./AccordionSummary-1.0.43-CNpHbZtu.js";import{A as W}from"./AccordionDetails-1.0.43-C8u8mZhB.js";import{F as T,a as A}from"./FormHelperText-1.0.43-BbvxPfFT.js";import{F as Z}from"./FormControlLabel-1.0.43-DhLqIzQC.js";import{S as Q}from"./Switch-1.0.43-DUXi6nEm.js";import{B as j}from"./Spinner-1.0.43-YmZqinVQ.js";import{T as V,a as S}from"./ToggleButtonGroup-1.0.43-y6Kkgg0C.js";import{u as X,S as Y,a as $,b as I,c as ee}from"./SettingsMapMarkers-1.0.43-Car8AF3W.js";import"./vendor-1.0.43-CN03Eozo.js";import"./loglevel-1.0.43-BZ7XahX3.js";import"./lodash-1.0.43-BGoSrRk7.js";import"./moment-1.0.43-C5S46NFB.js";import"./iconBase-1.0.43-BkINToSh.js";import"./Typography-1.0.43-CjHjtdZs.js";import"./useEnhancedEffect-1.0.43-DcXwKdLb.js";import"./index-1.0.43-Br_nYvvF.js";import"./notistack-1.0.43-CFZ1B9cW.js";import"./ConfirmDialog-1.0.43-HyVPTU5U.js";import"./AdminTheme-1.0.43-CqjS-p3h.js";import"./Menu-1.0.43-TbmZ3Ge2.js";import"./ThemeProvider-1.0.43-BdkGbeAu.js";import"./MenuItem-1.0.43-Uicrp-o6.js";import"./index-1.0.43-CvTha0tS.js";import"./FormLabel-1.0.43-DuYrsDLO.js";import"./useFormControl-1.0.43-D7bmEJOO.js";import"./TextField-1.0.43-DsZQBbKY.js";import"./Select-1.0.43-CISjJoqC.js";import"./utils-1.0.43-iop7lDec.js";import"./useControlled-1.0.43-DObA-A1B.js";import"./createSvgIcon-1.0.43-C8_lU5Lv.js";import"./Link-1.0.43-CsQWhuI0.js";import"./Collapse-1.0.43-CtSvLI94.js";import"./SwitchBase-1.0.43-jxlYBoq8.js";import"./useMapUpdater-1.0.43-CWbe2ro7.js";import"./CssUnitTextField-1.0.43-9DAGquvf.js";import"./RadioGroup-1.0.43-USnV9oxc.js";import"./Radio-1.0.43-GAuAP3gY.js";import"./Slider-1.0.43-DwDICOHK.js";import"./visuallyHidden-1.0.43-Dan1xhjv.js";import"./main-1.0.43.js";import"./react-number-format.es-1.0.43-Dn0EVwh2.js";const te=({appId:a,tableStore:u,mapSettings:h,updateTableSettings:s,setUpdateStatus:m})=>{var l;const i=P(a),b=M.useMemo(()=>{var p,r,x;let o=[];try{o=JSON.parse((x=(r=(p=i==null?void 0:i.app)==null?void 0:p.container)==null?void 0:r[0])==null?void 0:x.cnt_cls)}catch(g){d.error(g)}return o},[]);M.useEffect(()=>{c(F({appDbId:0,appId:a,appName:"",appTitle:"",appType:B.MAP,appCntId:0,appCntSeqNr:0,appDatabase:null,appTable:null,appColumns:b,appRelationTable:null,appRelationColumns:[],appRestApi:{authorization:k.AUTHORIZED,authorized_roles:[],authorized_users:[]},appAddToMenu:!1,appMenuTitle:"",appMetaData:void 0,mapApiKey:t.maps.apiKey,mapColumnLatitude:t.maps.columnLatitude,mapColumnLongitude:t.maps.columnLongitude}))},[]);const c=C(),n=G(),t=u.table;return M.useEffect(()=>{const o={...t.maps};o.apiKey=n.appMap.apiKey,o.columnLatitude=n.appMap.columnLatitude,o.columnLongitude=n.appMap.columnLongitude,s("maps",o)},[n.appMap]),e.jsxs(J,{disableGutters:!0,children:[e.jsx(q,{children:"Enable Map Integration"}),e.jsxs(W,{children:[e.jsxs(T,{fullWidth:!0,sx:{marginBottom:0},children:[e.jsx(Z,{control:e.jsx(Q,{checked:t.maps.enabled,onChange:o=>{var r,x,g;const p={...t.maps};if(p.enabled=!t.maps.enabled,s("maps",p),h===void 0){let f={};if(((g=(x=(r=i==null?void 0:i.app)==null?void 0:r.container)==null?void 0:x[0])==null?void 0:g.cnt_map)!==void 0)try{f=JSON.parse(i.app.container[0].cnt_map)}catch(E){d.error("Invalid JSON - chart settings"),d.error(E)}f===!1&&(f={}),d.debug(f);const y=L({},D,f);c(R({appId:a,mapState:y}))}o.stopPropagation()}}),label:"Enable"}),e.jsx(A,{component:"div",children:"Enable this feature to add a map to the table header or footer."})]}),((l=t==null?void 0:t.maps)==null?void 0:l.enabled)===!0&&e.jsxs(j,{sx:{display:"grid",gap:"20px",marginTop:"30px"},children:[e.jsxs("fieldset",{className:"pp-fieldset",children:[e.jsx("legend",{children:"Map Configuration"}),e.jsxs(j,{sx:{display:"grid",gap:"30px",marginTop:"5px"},children:[e.jsx(H,{app:n}),e.jsx(j,{sx:{"& .MuiFormHelperText-root > div":{marginBottom:"5px"}},children:e.jsx(O,{app:n})}),e.jsxs(j,{sx:{marginTop:"-10px"},children:[e.jsxs(V,{color:"primary",exclusive:!0,fullWidth:!0,value:"undocked",disabled:!0,onChange:(o,p)=>{const r={...t.maps};r.docked=p,s("maps",r),m(!0),o.stopPropagation()},children:[e.jsxs(S,{value:"top",disabled:u.state.masterDetailConditions!==void 0,children:[e.jsx(K,{})," Header"]}),e.jsxs(S,{value:"bottom",disabled:u.state.masterDetailConditions!==void 0,children:[e.jsx(U,{})," Footer"]}),e.jsxs(S,{value:"undocked",children:[e.jsx(_,{})," Undocked"]})]}),e.jsx(T,{children:e.jsx(A,{children:"Choose where the chart should be positioned: header, footer, or undocked. Charts for detail tables cannot be docked."})})]})]})]}),e.jsx(z,{title:"Some map configuration features require a premium license.",margin:"0"})]})]})]})},et=({appId:a})=>{var c,n;d.debug(a);const u=C(),h=N(a),s=w(a),m=X(a),i=(t,l,o)=>{const[p,...r]=l.split(".");return{...t,[p]:r.length?i(t[p],r.join("."),o):o}},b=(t,l)=>{d.debug(t,l);const o=i(s==null?void 0:s.table,t,l);d.debug(o),u(v({appId:a,tableSettings:o})),h(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{appId:a,tableStore:s,mapSettings:m,updateTableSettings:b,setUpdateStatus:h}),((n=(c=s==null?void 0:s.table)==null?void 0:c.maps)==null?void 0:n.enabled)===!0&&m!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{appId:a,mapSettings:m}),e.jsx($,{appId:a,mapSettings:m}),e.jsx(I,{appId:a,mapSettings:m,disableRadiusSearch:!0}),e.jsx(ee,{appId:a,mapSettings:m})]})]})};export{et as default};
