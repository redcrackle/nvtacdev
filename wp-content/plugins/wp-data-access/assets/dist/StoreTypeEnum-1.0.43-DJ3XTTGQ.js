import{l as n,ag as Pe,F as _e,A as x,a5 as g,t as W,ah as L,ai as z,aj as Ae,ak as Te,a as Oe,a9 as H,a6 as de,a7 as we,al as Je,G as Fe,am as De,S as xe,an as Re,ao as Ue,ap as Ie,aq as Be,ar as Ee,a8 as Me}from"./lib-1.0.43-GM4CAPbj.js";import{a as je}from"./hooks-1.0.43-Bzf6s8gj.js";const qe=(c,R)=>({app_id:c,cnt_id:R}),Ge=(c,R)=>({dbs:c,tbl:R}),Le=(c,R)=>{n.debug(c,R);const A=je(),ye=(i,u,l,_)=>{var F,O,D,P,f,y,U,I,B,E,M,j,q,G,V,Y,s,r,h,k,Q,X,Z,$,ee,le,se,ne,re,te,ue,oe,me,ce,ie,pe,be,fe,ge,ae,he;n.debug(l);const S=(F=l.access.insert)==null?void 0:F.some(t=>t.toUpperCase()==="POST"),C=(O=l.access.update)==null?void 0:O.some(t=>t.toUpperCase()==="POST"),a=(D=l.access.delete)==null?void 0:D.some(t=>t.toUpperCase()==="POST");l.src=Ge(i,u),l.privs={select:!0,insert:S,update:C,delete:a};let e={};((y=(f=(P=l==null?void 0:l.settings)==null?void 0:P.ui)==null?void 0:f.global)==null?void 0:y.table)!==!1?(e=g({},W,(B=(I=(U=l==null?void 0:l.settings)==null?void 0:U.ui)==null?void 0:I.global)==null?void 0:B.table),(V=(G=(q=(j=(M=(E=l==null?void 0:l.settings)==null?void 0:E.ui)==null?void 0:M.global)==null?void 0:j.table)==null?void 0:q.table)==null?void 0:G.pagination)!=null&&V.rowsPerPage&&(e.table.pagination.rowsPerPage=[...l.settings.ui.global.table.table.pagination.rowsPerPage]),(k=(h=(r=(s=(Y=l==null?void 0:l.settings)==null?void 0:Y.ui)==null?void 0:s.global)==null?void 0:r.table)==null?void 0:h.table)!=null&&k.defaultOrderBy&&(e.table.defaultOrderBy=[...l.settings.ui.global.table.table.defaultOrderBy])):e=g({},W,{table:{transactions:{insert:S,update:C,delete:a},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(Q=l==null?void 0:l.privs)==null?void 0:Q.delete}}});const d=[],b={},N=[],T={};for(let t=0;t<l.columns.length;t++){const Se=L(l.columns[t].column_name,l.table_labels[l.columns[t].column_name]??l.columns[t].column_name);d[t]=Se,b[l.columns[t].column_name]=Se;const Ne=z(l.columns[t].column_name,l.form_labels[l.columns[t].column_name]??l.columns[t].column_name);N[t]=Ne,T[l.columns[t].column_name]=Ne}n.debug(d,b,N,T);const v=[];if(Array.isArray(e.columns)&&e.columns.length>0){for(let t=0;t<e.columns.length;t++)b[e.columns[t].columnName]!==void 0?v.push(g({},b[e.columns[t].columnName],e.columns[t])):v.push(g({},L(l.columns[t].column_name),e.columns[t]));e.columns=v}else e.columns=d;e.table.largeTableSupport.saved===Ae.AUTO?e.table.largeTableSupport.actual=Te(l):e.table.largeTableSupport.actual=e.table.largeTableSupport.saved,n.debug(e);let p={...H};(($=(Z=(X=l==null?void 0:l.settings)==null?void 0:X.ui)==null?void 0:Z.global)==null?void 0:$.form)!==!1&&(p=g({},H,(se=(le=(ee=l==null?void 0:l.settings)==null?void 0:ee.ui)==null?void 0:le.global)==null?void 0:se.form));const w=[];if(Array.isArray(p.columns)&&p.columns.length>0){for(let t=0;t<p.columns.length;t++)T[p.columns[t].columnName]!==void 0?w.push(g({},T[p.columns[t].columnName],p.columns[t])):w.push(g({},z(p.columns[t].column_name),p.columns[t]));p.columns=w}else p.columns=N;const o=De.getSelectors().selectSelected(xe.getState().explorer);n.debug("selected",o),o&&o[i]==="wp"&&((re=(ne=l==null?void 0:l.settings)==null?void 0:ne.wp)==null?void 0:re.tables)!==void 0&&Array.isArray(l.settings.wp.tables)&&l.settings.wp.tables.includes(u)&&(p.form={...Re},p.form.preserveSpacesOnUpdate=!0);let m={};if(((oe=(ue=(te=l==null?void 0:l.settings)==null?void 0:te.ui)==null?void 0:ue.global)==null?void 0:oe.theme)!==void 0&&((ie=(ce=(me=l==null?void 0:l.settings)==null?void 0:me.ui)==null?void 0:ce.global)==null?void 0:ie.theme)!==null&&((fe=(be=(pe=l==null?void 0:l.settings)==null?void 0:pe.ui)==null?void 0:be.global)==null?void 0:fe.theme)!=="")try{m=JSON.parse((he=(ae=(ge=l==null?void 0:l.settings)==null?void 0:ge.ui)==null?void 0:ae.global)==null?void 0:he.theme)}catch(t){n.error("Invalid JSON - theme settings"),n.error(t)}m===!1&&(m={});const J=g({},Ue,m);return K(l,e,p,J,_===!0)},Ce=(i,u,l,_,S,C)=>{var U,I,B,E,M,j,q,G,V,Y;n.debug(i,u,l,_,S);const a=u.app.app[0];n.debug(a);const e=u.app.container[0];n.debug(e);let d={};try{d=JSON.parse(a.app_settings)}catch(s){n.error("Invalid JSON - app settings"),n.error(s)}n.debug(d);let b={};try{b=JSON.parse(e.cnt_cls)}catch(s){n.error("Invalid JSON - app columns"),n.error(s)}n.debug(b);const N=a.app_type,T=Number(N)===x.DATAENTRY||Number(N)===x.REGISTRATION,v=Number(N)===x.DATAENTRY||Number(N)===x.REGISTRATION||Number(N)===x.UPDATEFORM,p=Number(N)===x.DATAENTRY;n.debug(T,v,p),u.src=qe(i,e.cnt_id),u.privs={select:!0,insert:T,update:v,delete:p};const w=g({},W,{table:{transactions:{insert:T,update:v,delete:p},bulkActions:{pdf:!1,csv:!0,json:!0,excel:!1,xml:!0,sql:!0,delete:(U=u==null?void 0:u.privs)==null?void 0:U.delete}}});n.debug(w);let o={};if(e.cnt_table!==void 0&&e.cnt_table!==null&&e.cnt_table!=="")try{o=JSON.parse(e.cnt_table)}catch(s){n.error("Invalid JSON - table settings"),n.error(s)}n.debug(o);const m=g({},w,o);(B=(I=o==null?void 0:o.table)==null?void 0:I.pagination)!=null&&B.rowsPerPage&&(m.table.pagination.rowsPerPage=[...o.table.pagination.rowsPerPage]),(E=o==null?void 0:o.table)!=null&&E.defaultOrderBy&&(m.table.defaultOrderBy=[...o.table.defaultOrderBy]),n.debug(m);const J=[],F={},O=[],D={};for(let s=0;s<b.length;s++)if(b[s].isSelected===!0){let r=!0;const h=L(b[s].columnName,u.table_labels[b[s].columnName]??b[s].columnName,r);J.push(h),F[b[s].columnName]=h;const k=z(b[s].columnName,u.form_labels[b[s].columnName]??b[s].columnName,r);O.push(k),D[b[s].columnName]=k}if(n.debug(J),n.debug(O),Array.isArray(m.columns)&&m.columns.length>0){const s=[];for(let r=0;r<m.columns.length;r++)m.columns[r].computedField!==void 0?s.push(g({},L(m.columns[r].columnName),m.columns[r])):F[m.columns[r].columnName]!==void 0&&s.push(g({},F[m.columns[r].columnName],m.columns[r]));J.map(r=>{s.filter(h=>h.columnName===r.columnName).length===0&&s.push(r)}),n.debug(s),m.columns=s}else m.columns=J;if(m.table.largeTableSupport.saved===Ae.AUTO?m.table.largeTableSupport.actual=Te(u):m.table.largeTableSupport.actual=m.table.largeTableSupport.saved,(u==null?void 0:u.isRelationSelectionTable)===!0&&(o==null?void 0:o.columns)!==void 0&&Array.isArray(o.columns)){const s=[];o.columns.map(r=>{if(r.columnName.startsWith(Oe.relationTablePrefix)){const h={...r};h.columnName=r.columnName.substring(Oe.relationTablePrefix.length),s.push(h)}}),m.columns=[...s]}n.debug(m);let P={};if((e==null?void 0:e.cnt_form)!==void 0&&(e==null?void 0:e.cnt_form)!==null&&(e==null?void 0:e.cnt_form)!==""||u.useRform===!0&&(e==null?void 0:e.cnt_rform)!==void 0&&(e==null?void 0:e.cnt_rform)!==null&&(e==null?void 0:e.cnt_rform)!=="")try{u.useRform===!0?P=JSON.parse(e.cnt_rform):P=JSON.parse(e.cnt_form)}catch(s){n.error("Invalid JSON - form settings"),n.error(s)}n.debug(P);const f=g({},H,P);if(n.debug(f),Array.isArray(f.columns)&&f.columns.length>0){const s=[];for(let r=0;r<f.columns.length;r++)f.columns[r].computedField!==void 0?s.push(g({},O[r],f.columns[r])):D[f.columns[r].columnName]!==void 0&&s.push(g({},D[f.columns[r].columnName],f.columns[r]));O.map(r=>{s.filter(h=>h.columnName===r.columnName).length===0&&s.push(r)}),f.columns=s}else f.columns=O;Array.isArray((j=(M=u==null?void 0:u.settings)==null?void 0:M.wp)==null?void 0:j.tables)&&u.settings.wp.tables.includes(e==null?void 0:e.cnt_tbl)&&(f.form.preserveSpacesOnUpdate=!0),n.debug(f);let y={};if((a==null?void 0:a.app_theme)!==void 0&&(a==null?void 0:a.app_theme)!==null&&(a==null?void 0:a.app_theme)!=="")try{y=JSON.parse(a.app_theme)}catch(s){n.error("Invalid JSON - theme settings"),n.error(s)}if(y===!1&&(y={}),n.debug(y),S!==void 0&&(u.appRootId=S),((G=(q=o==null?void 0:o.table)==null?void 0:q.charts)==null?void 0:G.enabled)===!0){let s={};if((e==null?void 0:e.cnt_chart)!==void 0&&(e==null?void 0:e.cnt_chart)!==null&&(e==null?void 0:e.cnt_chart)!=="")try{s=JSON.parse(e.cnt_chart)}catch(h){n.error("Invalid JSON - chart settings"),n.error(h)}s===!1&&(s={}),n.debug(s);const r=g({},de,s);n.debug(r),A(we({appId:c,chartState:r}))}if(((Y=(V=o==null?void 0:o.table)==null?void 0:V.maps)==null?void 0:Y.enabled)===!0){let s={};if((e==null?void 0:e.cnt_map)!==void 0&&(e==null?void 0:e.cnt_map)!==null&&(e==null?void 0:e.cnt_map)!=="")try{s=JSON.parse(e.cnt_map)}catch(h){n.error("Invalid JSON - chart settings"),n.error(h)}s===!1&&(s={}),n.debug(s);const r=g({},Je,s);A(Fe({appId:c,mapState:r}))}return K(u,m,f,y,l===!0,C)},ve=(i,u)=>{n.debug(i);const l=i.app.app[0];n.debug(l);let _={};try{_=JSON.parse(l.app_settings)}catch(S){n.error("Invalid JSON - app settings"),n.error(S)}return n.debug(_),A(Pe({appId:c,apps:i.app.apps,titles:i.app.titles,appSettings:_})),A(_e({appId:c,metaData:{...i,isExploring:u??!1}})),!0},K=(i,u,l,_,S,C)=>(n.debug(i),A(_e({appId:c,metaData:{...i}})),A(Ie({appId:c,tableState:u,tableAccess:{insert:i.privs.insert,update:i.privs.update,delete:i.privs.delete},isView:Be(i),exploring:S})),A(Ee({appId:c,formState:l})),A(Me({appId:c,themeState:_})),C!==void 0&&C(),!0);return{prepareAdminStore:ye,prepareAppStore:Ce,prepareApp:ve}};var Ve=(c=>(c[c.ADMIN=0]="ADMIN",c[c.APP=1]="APP",c))(Ve||{});export{qe as D,Ve as S,Le as u};
