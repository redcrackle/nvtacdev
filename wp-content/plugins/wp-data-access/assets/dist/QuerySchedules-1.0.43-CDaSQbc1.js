import{j as r}from"./cm-1.0.43-BIThoEwM.js";import{r as p}from"./redux-1.0.43-X9ShETON.js";import{P as M,b as O,a as Q}from"./index-1.0.43-DuBV8iHb.js";import{am as P,k as A}from"./index-1.0.43-Br_nYvvF.js";import{P as I}from"./PremiumFeature-1.0.43-BD8gtQwD.js";import{u as R}from"./MainQueryBuilder-1.0.43-Bpy4iomZ.js";import{d as Y}from"./dayjs.min-1.0.43-B1axidXt.js";import{B as k,C as z}from"./ConfirmDialog-1.0.43-HyVPTU5U.js";import{c as E,f as F}from"./QueryBuilder-1.0.43-DowaLN4B.js";import{D as $}from"./QueryToolbar-1.0.43-DtiMOyJg.js";import{e as S}from"./notistack-1.0.43-CFZ1B9cW.js";import{l as v}from"./lib-1.0.43-GM4CAPbj.js";import{T as N}from"./Tooltip-1.0.43-Dw3sfo8K.js";import{I as B}from"./iconBase-1.0.43-BkINToSh.js";import{P as L}from"./Menu-1.0.43-TbmZ3Ge2.js";import{C as W,a as G}from"./CardContent-1.0.43-B1eq8QmP.js";import{C as J}from"./CardHeader-1.0.43-Cj6GRAA3.js";import{B as w}from"./Spinner-1.0.43-YmZqinVQ.js";import{T as U,b as _,c as i,a as V}from"./TableRow-1.0.43-PHyz2C67.js";import{T as X}from"./TableHead-1.0.43-DimterWj.js";import{C as Z}from"./CardActions-1.0.43-CprgiBCD.js";import"./vendor-1.0.43-CN03Eozo.js";import"./index-1.0.43-DTrIm2Pv.js";import"./Typography-1.0.43-CjHjtdZs.js";import"./useEnhancedEffect-1.0.43-DcXwKdLb.js";import"./index-1.0.43-CvTha0tS.js";import"./AdminTheme-1.0.43-CqjS-p3h.js";import"./FormLabel-1.0.43-DuYrsDLO.js";import"./useFormControl-1.0.43-D7bmEJOO.js";import"./main-1.0.43.js";import"./loglevel-1.0.43-BZ7XahX3.js";import"./lodash-1.0.43-BGoSrRk7.js";import"./moment-1.0.43-C5S46NFB.js";import"./hooks-1.0.43-Bzf6s8gj.js";import"./StartQueryBuilder-1.0.43-DFJvLNPB.js";import"./ActionsExplorer-1.0.43-BvdT5anO.js";import"./RestApi-1.0.43-DDknciaN.js";import"./DatabaseTypeEnum-1.0.43-DeJfpW1u.js";import"./ThemeProvider-1.0.43-BdkGbeAu.js";import"./lang-1.0.43-B1WmIuB6.js";import"./index-1.0.43-Lwi8RVeB.js";import"./SanitizeComponent-1.0.43-DS8pdFaO.js";import"./dompurify-1.0.43-DhD2mIk-.js";import"./FormHelperText-1.0.43-BbvxPfFT.js";import"./utils-1.0.43-iop7lDec.js";import"./FormControlLabel-1.0.43-DhLqIzQC.js";import"./Checkbox-1.0.43-C_H-ygma.js";import"./SwitchBase-1.0.43-jxlYBoq8.js";import"./useControlled-1.0.43-DObA-A1B.js";import"./createSvgIcon-1.0.43-C8_lU5Lv.js";import"./Divider-1.0.43-BNePHRrN.js";import"./MenuItem-1.0.43-Uicrp-o6.js";import"./TextField-1.0.43-DsZQBbKY.js";import"./Select-1.0.43-CISjJoqC.js";import"./InputAdornment-1.0.43-9P5bF1dN.js";import"./TabPanel-1.0.43-BFjnBi0G.js";import"./useThemeProps-1.0.43-C5lTKcwO.js";import"./getThemeProps-1.0.43-5uxEwZ_e.js";import"./TabList-1.0.43-wevj3JyD.js";import"./Tabs-1.0.43-C3a4iH_4.js";import"./Switch-1.0.43-DUXi6nEm.js";/* empty css                    */import"./index-1.0.43-Bovnh_Vk.js";import"./index-1.0.43-Crrt7rhH.js";import"./ctc-1.0.43-C-ZXureb.js";import"./react-number-format.es-1.0.43-Dn0EVwh2.js";import"./ToggleButtonGroup-1.0.43-y6Kkgg0C.js";import"./AdapterDayjs-1.0.43-paeIPXvc.js";import"./useMobilePicker-1.0.43-wKjIFMVp.js";import"./index-1.0.43-C6_8mZyP.js";import"./Popper-1.0.43-8Yb3KIgh.js";import"./visuallyHidden-1.0.43-Dan1xhjv.js";import"./ListItem-1.0.43-Bg1FR-64.js";import"./Chip-1.0.43-Ci13k7gB.js";import"./DateTimePicker-1.0.43-MatMNCyw.js";import"./timeViewRenderers-1.0.43-BWypgxuk.js";import"./dateViewRenderers-1.0.43-X8xYeo7E.js";import"./FileSaver.min-1.0.43-DXynXHP3.js";const K=m=>{const t=R(),[l,j]=p.useState([]),g=()=>{var u,c,h,x,e,o,s,n,D;const a=[],b=t.queries[m].queryName,d=t.queries[m].access;for(let y in t.cron.cron)if(t.cron.cron[y].wpda_run_scheduled_sql){const f=t.cron.cron[y].wpda_run_scheduled_sql,C=Object.keys(f)[0],T=(h=(c=(u=f[C])==null?void 0:u.args)==null?void 0:c.args)==null?void 0:h.name,q=(o=(e=(x=f[C])==null?void 0:x.args)==null?void 0:e.args)==null?void 0:o.access,H=(D=(n=(s=f[C])==null?void 0:s.args)==null?void 0:n.args)==null?void 0:D.params;T===b&&q===d&&a.push({dt:Y.unix(Number(y)).format("YYYY-MM-DD HH:mm:ss"),name:T,access:q,params:H})}j(a)};return p.useEffect(()=>{g()},[t.cron.cron]),l},De=({queryKey:m,queryBuilderState:t})=>{const l=K(m),j=E(),[g,a]=p.useState({}),[b,d]=p.useState(!1),[u,c]=p.useState(!1),h=e=>e?Object.keys(e).map(o=>`${o} = ${e[o]}`).join(", "):"",x=e=>{var o;if((o=e==null?void 0:e.notify)!=null&&o.email){let s=e.notify.email;const n=[];return e.notify.csv&&n.push("csv"),e.notify.json&&n.push("json"),e.notify.xml&&n.push("xml"),n.length>0?s+" ("+n.join(",")+")":s}else return""};return r.jsxs(r.Fragment,{children:[r.jsx(M,{variant:"popover",children:e=>r.jsxs(r.Fragment,{children:[r.jsx(N,{title:"Schedule query",children:r.jsx(B,{...O(e),sx:{color:"inherit","&.Mui-disabled":{color:"grey"}},children:r.jsx(P,{})})}),r.jsx(L,{...Q(e),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:r.jsxs(W,{sx:{padding:"4px"},children:[r.jsx(J,{title:"Schedule Query",sx:{paddingBottom:"4px"}}),r.jsxs(G,{children:[l.length===0?r.jsx(w,{children:"This query is currently not scheduled."}):r.jsx(w,{sx:{marginTop:0,border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px",padding:"0 0 10px 0"},children:r.jsxs(U,{sx:{width:"100%","& *":{border:"none !important"},"& td":{padding:"10px",lineHeight:1},"& th":{padding:"10px",fontWeight:"bold"}},children:[r.jsx(X,{children:r.jsxs(_,{children:[r.jsx(i,{}),r.jsx(i,{children:"Next run"}),r.jsx(i,{children:"Parameters"}),r.jsx(i,{children:"Notify"}),r.jsx(i,{})]})}),r.jsxs(V,{children:[...l.map(o=>{var s;return r.jsxs(_,{children:[r.jsx(i,{sx:{paddingLeft:"20px !important"},children:r.jsx(P,{})}),r.jsx(i,{children:o.dt}),r.jsx(i,{children:h((s=o.params)==null?void 0:s.params)}),r.jsx(i,{children:x(o.params)}),r.jsx(i,{sx:{paddingRight:"20px !important"},children:r.jsx(N,{title:"Delete",children:r.jsx(B,{color:"error",size:"small",onClick:()=>{a(o.params),d(!0)},children:r.jsx(A,{})})})})]},o.dt)})]})]})}),r.jsx(I,{})]}),r.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",justifyContent:"space-between",padding:"8px 16px 16px 16px"},children:[r.jsx(k,{color:"primary",variant:"contained",onClick:()=>{c(!0)},children:"Schedule"}),r.jsx(k,{color:"primary",variant:"contained",onClick:()=>{e.close()},children:"Done"})]})]})})]})}),r.jsx($,{queryKey:m,queryBuilderState:t,scheduling:u,setScheduling:c,limit:"100"}),r.jsx(z,{title:"Delete Schedule?",message:"Are you sure you want to delete this schedule? This action cannot be undone!",open:b,setOpen:d,onConfirm:()=>{F(t.queries[m].queryName,t.queries[m].access,g,e=>{v.debug(e),(e==null?void 0:e.code)==="ok"&&(e!=null&&e.message)?(j(),S(e.message,{variant:"success"})):(v.error("Invalid response"),S("Invalid response",{variant:"error"}))},e=>{v.error(e),S(e,{variant:"error"})})}})]})};export{De as default};
