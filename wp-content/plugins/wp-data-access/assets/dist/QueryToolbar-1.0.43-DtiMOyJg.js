const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./QueryParams-1.0.43-Bh_wwBTE.js","./cm-1.0.43-BIThoEwM.js","./redux-1.0.43-X9ShETON.js","./vendor-1.0.43-CN03Eozo.js","./index-1.0.43-DuBV8iHb.js","./index-1.0.43-DTrIm2Pv.js","./ConfirmDialog-1.0.43-HyVPTU5U.js","./iconBase-1.0.43-BkINToSh.js","./Typography-1.0.43-CjHjtdZs.js","./lib-1.0.43-GM4CAPbj.js","./loglevel-1.0.43-BZ7XahX3.js","./lodash-1.0.43-BGoSrRk7.js","./moment-1.0.43-C5S46NFB.js","./useEnhancedEffect-1.0.43-DcXwKdLb.js","./AdminTheme-1.0.43-CqjS-p3h.js","./index-1.0.43-Br_nYvvF.js","./notistack-1.0.43-CFZ1B9cW.js","./hooks-1.0.43-Bzf6s8gj.js","./StartQueryBuilder-1.0.43-DFJvLNPB.js","./main-1.0.43.js","./PremiumFeature-1.0.43-BD8gtQwD.js","./index-1.0.43-CvTha0tS.js","./FormLabel-1.0.43-DuYrsDLO.js","./useFormControl-1.0.43-D7bmEJOO.js","./Tooltip-1.0.43-Dw3sfo8K.js","./ThemeProvider-1.0.43-BdkGbeAu.js","./useControlled-1.0.43-DObA-A1B.js","./Popper-1.0.43-8Yb3KIgh.js","./Menu-1.0.43-TbmZ3Ge2.js","./CardContent-1.0.43-B1eq8QmP.js","./CardHeader-1.0.43-Cj6GRAA3.js","./Spinner-1.0.43-YmZqinVQ.js","./TextField-1.0.43-DsZQBbKY.js","./Select-1.0.43-CISjJoqC.js","./utils-1.0.43-iop7lDec.js","./createSvgIcon-1.0.43-C8_lU5Lv.js","./FormHelperText-1.0.43-BbvxPfFT.js","./CardActions-1.0.43-CprgiBCD.js","./QuerySchedules-1.0.43-CDaSQbc1.js","./MainQueryBuilder-1.0.43-Bpy4iomZ.js","./ActionsExplorer-1.0.43-BvdT5anO.js","./RestApi-1.0.43-DDknciaN.js","./DatabaseTypeEnum-1.0.43-DeJfpW1u.js","./dayjs.min-1.0.43-B1axidXt.js","./lang-1.0.43-B1WmIuB6.js","./QueryBuilder-1.0.43-DowaLN4B.js","./index-1.0.43-Lwi8RVeB.js","./SanitizeComponent-1.0.43-DS8pdFaO.js","./dompurify-1.0.43-DhD2mIk-.js","./FormControlLabel-1.0.43-DhLqIzQC.js","./Checkbox-1.0.43-C_H-ygma.js","./SwitchBase-1.0.43-jxlYBoq8.js","./Divider-1.0.43-BNePHRrN.js","./MenuItem-1.0.43-Uicrp-o6.js","./InputAdornment-1.0.43-9P5bF1dN.js","./TabPanel-1.0.43-BFjnBi0G.js","./useThemeProps-1.0.43-C5lTKcwO.js","./getThemeProps-1.0.43-5uxEwZ_e.js","./TabList-1.0.43-wevj3JyD.js","./Tabs-1.0.43-C3a4iH_4.js","./Switch-1.0.43-DUXi6nEm.js","./main-1.0.43-LBsY5zsP.css","./TableRow-1.0.43-PHyz2C67.js","./TableHead-1.0.43-DimterWj.js","./index-1.0.43-Bovnh_Vk.js","./index-1.0.43-Crrt7rhH.js","./ctc-1.0.43-C-ZXureb.js","./react-number-format.es-1.0.43-Dn0EVwh2.js","./ToggleButtonGroup-1.0.43-y6Kkgg0C.js","./AdapterDayjs-1.0.43-paeIPXvc.js","./useMobilePicker-1.0.43-wKjIFMVp.js","./index-1.0.43-C6_8mZyP.js","./visuallyHidden-1.0.43-Dan1xhjv.js","./ListItem-1.0.43-Bg1FR-64.js","./Chip-1.0.43-Ci13k7gB.js","./DateTimePicker-1.0.43-MatMNCyw.js","./timeViewRenderers-1.0.43-BWypgxuk.js","./dateViewRenderers-1.0.43-X8xYeo7E.js","./FileSaver.min-1.0.43-DXynXHP3.js","./AiAssistant-1.0.43-CBOol-c4.js","./AccordionSummary-1.0.43-CNpHbZtu.js","./Collapse-1.0.43-CtSvLI94.js","./AccordionDetails-1.0.43-C8u8mZhB.js","./Autocomplete-1.0.43-C-3GGJwT.js","./Close-1.0.43-DZEA4jNx.js"])))=>i.map(i=>d[i]);
import{_ as te}from"./main-1.0.43.js";import{j as e}from"./cm-1.0.43-BIThoEwM.js";import{r as a}from"./redux-1.0.43-X9ShETON.js";import{a9 as Pe,aa as Ie,A as De,T as we,Y as Me,ak as Re,z as Ee,al as Oe,k as Le,am as _e,an as Qe,ao as Ne,M as Fe}from"./index-1.0.43-Br_nYvvF.js";import{G as We,I as K}from"./iconBase-1.0.43-BkINToSh.js";import{P as ze}from"./index-1.0.43-Bovnh_Vk.js";import{a as re}from"./hooks-1.0.43-Bzf6s8gj.js";import{b as be,i as ve,j as ie,u as ge,k as Be}from"./StartQueryBuilder-1.0.43-DFJvLNPB.js";import{A as w}from"./AdminTheme-1.0.43-CqjS-p3h.js";import{k as Ve}from"./index-1.0.43-CvTha0tS.js";import{A as ee,u as Ce,q as He,a as ye,b as Ue,c as Ge,d as Je}from"./QueryBuilder-1.0.43-DowaLN4B.js";import{u as Xe}from"./MainQueryBuilder-1.0.43-Bpy4iomZ.js";import{l as m,o as ae,C as Ye}from"./lib-1.0.43-GM4CAPbj.js";import{C as $e}from"./index-1.0.43-Crrt7rhH.js";import{e as b}from"./notistack-1.0.43-CFZ1B9cW.js";import{N as Se}from"./react-number-format.es-1.0.43-Dn0EVwh2.js";import{D as oe,P as le,a as ce,b as de,c as pe,d as xe,B as L,C as ke}from"./ConfirmDialog-1.0.43-HyVPTU5U.js";import{B as d,S as Ze}from"./Spinner-1.0.43-YmZqinVQ.js";import{T as P,I as qe}from"./TextField-1.0.43-DsZQBbKY.js";import{F as j,a as B}from"./FormHelperText-1.0.43-BbvxPfFT.js";import{T as Ke,a as je}from"./ToggleButtonGroup-1.0.43-y6Kkgg0C.js";import{d as es}from"./dayjs.min-1.0.43-B1axidXt.js";import{P as ss}from"./PremiumFeature-1.0.43-BD8gtQwD.js";import{A as ts}from"./AdapterDayjs-1.0.43-paeIPXvc.js";import{S as Te}from"./Select-1.0.43-CISjJoqC.js";import{M as u}from"./MenuItem-1.0.43-Uicrp-o6.js";import{F as se}from"./FormLabel-1.0.43-DuYrsDLO.js";import{T as rs,a as ns,b as as,c as ne}from"./TableRow-1.0.43-PHyz2C67.js";import{T as I}from"./Tooltip-1.0.43-Dw3sfo8K.js";import{F as D}from"./FormControlLabel-1.0.43-DhLqIzQC.js";import{S as is}from"./Switch-1.0.43-DUXi6nEm.js";import{C as O}from"./Checkbox-1.0.43-C_H-ygma.js";import{L as os}from"./useMobilePicker-1.0.43-wKjIFMVp.js";import{D as ls}from"./DateTimePicker-1.0.43-MatMNCyw.js";import{a as cs}from"./RestApi-1.0.43-DDknciaN.js";import{F as ds}from"./FileSaver.min-1.0.43-DXynXHP3.js";import{M as ps}from"./Menu-1.0.43-TbmZ3Ge2.js";function xs(r){return We({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"},child:[]}]})(r)}const us=({queries:r,queryKey:s,copyDialog:y,setCopyDialog:x,newName:l,setNewName:i})=>{var h,k,v,p;const g=re(),{createQueryKey:A}=Ce(),[c,S]=a.useState(r[s].access);return e.jsxs(oe,{open:y,onClose:()=>x(!1),PaperComponent:le,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(ce,{sx:{color:(k=(h=w)==null?void 0:h.palette)==null?void 0:k.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Copy query"}),e.jsx(de,{children:e.jsx(pe,{component:"div",sx:{color:(p=(v=w)==null?void 0:v.palette)==null?void 0:p.primary.main},children:e.jsxs(d,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(P,{label:"Copy",disabled:!0,value:r[s].queryName}),e.jsx(P,{label:"To",value:l,onChange:f=>{i(f.target.value)}}),e.jsxs(j,{fullWidth:!0,children:[e.jsxs(Ke,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr","& svg":{marginRight:"5px",height:"1.2em",width:"1.2em"}},value:c,children:[e.jsxs(je,{value:ee.USER,onClick:()=>{S(ee.USER)},children:[e.jsx(Pe,{})," Only Me"]}),e.jsxs(je,{value:ee.GLOBAL,onClick:()=>{S(ee.GLOBAL)},children:[e.jsx(Ie,{})," Everyone"]})]}),e.jsx(B,{children:"Define who can access this query."})]})]})})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:f=>{x(!1);const o=A(c,l);He(r[s].access,r[s].queryName,c,l,C=>{m.debug(C),(C==null?void 0:C.code)==="ok"&&(g(be({queryKey:o,query:{access:c,queryName:l,query:r[s].query,schemaName:r[s].schemaName,isVisual:r[s].isVisual,params:r[s].params}})),g(ve({tabIndex:o})),b("Query succesfully saved",{variant:"success"}))},C=>{m.error(C),b(C,{variant:"error"})}),f.stopPropagation()},children:"Copy"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:f=>{x(!1),f.stopPropagation()},children:"Cancel"})]})})]})},ms=({queries:r,queryKey:s,renameDialog:y,setRenameDialog:x,newName:l,setNewName:i})=>{var S,h,k,v;const g=re(),{createQueryKey:A}=Ce(),c=p=>{g(be({queryKey:p,query:{access:r[s].access,queryName:l,query:r[s].query,schemaName:r[s].schemaName,isVisual:r[s].isVisual,isInserting:r[s].isInserting,params:r[s].params}})),g(ie({queryKey:s})),g(ve({tabIndex:p}))};return e.jsxs(oe,{open:y,onClose:()=>x(!1),PaperComponent:le,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(ce,{style:{color:(h=(S=w)==null?void 0:S.palette)==null?void 0:h.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Rename query"}),e.jsx(de,{children:e.jsx(pe,{component:"div",sx:{color:(v=(k=w)==null?void 0:k.palette)==null?void 0:v.primary.main},children:e.jsxs(d,{sx:{paddingTop:"5px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(P,{label:"Old query name",disabled:!0,value:r[s].queryName}),e.jsx(P,{label:"New query name",value:l,onChange:p=>{i(p.target.value)}})]})})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"0 20px 20px 20px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",disabled:l.trim()==="",onClick:p=>{x(!1);const f=A(r[s].access,l);r[s].isInserting!==!0?ye(r[s].access,r[s].schemaName,l,ae(r[s].query),!1,r[s].queryName,!0,r[s].params,o=>{m.debug(o),(o==null?void 0:o.code)==="ok"&&(c(f),b("Query succesfully renamed",{variant:"success"}))},o=>{m.error(o),b(o,{variant:"error"})}):r[f]?b("Query name already exists",{variant:"error"}):c(f),p.stopPropagation()},children:"Rename"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:p=>{x(!1),p.stopPropagation()},children:"Cancel"})]})})]})},hs=({queries:r,queryKey:s,confirmDelete:y,setConfirmDelete:x})=>{const l=re();return e.jsx(ke,{title:"Delete query",message:e.jsxs("div",{children:["Are you sure you want to delete query ",r[s].queryName,"?",e.jsx("br",{}),e.jsx("strong",{children:"This action cannot be undone!"})]}),open:y,setOpen:x,onConfirm:()=>{l(ie({queryKey:s})),Ue(r[s].access,r[s].queryName,i=>{m.debug(i),b("Query successfully deleted",{variant:"success"})},i=>{m.error(i),b(i,{variant:"error"})})}})},fs=({queryKey:r,queryBuilderState:s,scheduling:y,setScheduling:x,limit:l})=>{var W,X,z,Y;Ge();const[i,g]=a.useState(es()),[A,c]=a.useState("nonrepeating"),[S,h]=a.useState(!0),[k,v]=a.useState(!0),[p,f]=a.useState(100),[o,C]=a.useState(s.queries[r].params),[_,V]=a.useState(!1),[H,Q]=a.useState(""),[N,U]=a.useState(!1),[F,G]=a.useState(!1),[M,J]=a.useState(!1);return a.useEffect(()=>{const n=localStorage.getItem("ppQueryBuilderNotify");if(n!==null){const T=JSON.parse(n);T.email&&(V(!0),Q(T.email),U(T.csv),G(T.json),J(T.xml))}},[]),a.useEffect(()=>{},[y]),e.jsxs(oe,{open:y,onClose:()=>x(!1),PaperComponent:le,"aria-labelledby":"confirm-dialog",closeAfterTransition:!1,children:[e.jsx(ce,{sx:{color:(X=(W=w)==null?void 0:W.palette)==null?void 0:X.primary.main,marginTop:"10px",cursor:"move"},id:"draggable-dialog-title",children:"Schedule query"}),e.jsx(de,{children:e.jsxs(pe,{component:"div",sx:{color:(Y=(z=w)==null?void 0:z.palette)==null?void 0:Y.primary.main,marginTop:"5px",display:"grid",gap:"30px"},children:[e.jsx(os,{dateAdapter:ts,children:e.jsx(ls,{label:"Start date and time",value:i,onChange:n=>{g(n)},slotProps:{textField:{helperText:"First execution time."}},disabled:!0})}),e.jsxs(j,{fullWidth:!0,children:[e.jsx(qe,{variant:"outlined",children:"Recurrence"}),e.jsxs(Te,{MenuProps:{id:"pp-select-menu"},label:"Recurrence",value:A,onChange:n=>{c(n.target.value)},disabled:!0,children:[e.jsx(u,{value:"nonrepeating",children:"Only Once (non-repeating)"},"nonrepeating"),...Object.keys(s.cron.intervalSorted).map(n=>e.jsx(u,{value:s.cron.intervalSorted[n].key,children:s.cron.schedules[s.cron.intervalSorted[n].key].display},s.cron.intervalSorted[n].key))]}),e.jsx(B,{children:"How often the event should subsequently recur."})]}),o&&Object.keys(o).length>0&&e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Parameters"})}),e.jsx(rs,{sx:{width:"auto",margin:"10px 0 20px 5px","& *":{border:"none"},"& td":{padding:"10px",fontWeight:"bold"}},children:e.jsx(ns,{children:Object.keys(o).map(n=>e.jsxs(as,{children:[e.jsx(ne,{sx:{paddingLeft:"16px !important",border:"none",color:"rgba(0, 0, 0, 0.38)"},children:n}),e.jsx(ne,{sx:{border:"none",width:"20px",textAlign:"center",color:"rgba(0, 0, 0, 0.38)"},children:"="}),e.jsx(ne,{sx:{border:"none"},children:e.jsx(I,{title:"",children:e.jsx(P,{type:"text",variant:"outlined",value:o[n],autoComplete:"off",onChange:T=>{const $={...o};$[n]=T.target.value,C($)},sx:{width:"60px","& input":{padding:0}},disabled:!0})})})]},n))})})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Settings"})}),e.jsxs(d,{sx:{padding:"20px 20px 25px 20px"},children:[e.jsxs(j,{fullWidth:!0,children:[e.jsx(D,{control:e.jsx(is,{checked:S,onChange:n=>{h(!S),n.stopPropagation()},disabled:!0}),label:"WordPress Table Protection"}),e.jsx(B,{sx:{marginTop:"5px"},children:"Protect WordPress tables to prevent accidental or harmful changes."})]}),e.jsxs(d,{sx:{marginTop:"10px",display:"flex",justifyContent:"start"},children:[e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"8px"},control:e.jsx(O,{checked:k,onClick:n=>{v(!k),n.preventDefault(),n.stopPropagation()},color:"primary",disabled:!0,sx:{marginRight:"10px"}}),label:"Max rows: "})}),e.jsx(Se,{customInput:P,value:p,disabled:!0,variant:"outlined",onValueChange:({value:n})=>{f(Number(n))},onInvalid:n=>{n.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})]})]}),e.jsxs("fieldset",{className:"pp-fieldset",style:{marginTop:"-10px",padding:"0 10px"},children:[e.jsx("legend",{children:e.jsx(se,{sx:{padding:0,fontSize:"13px"},children:"Notifications"})}),e.jsxs(d,{sx:{padding:"20px 10px 20px 20px"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"9px"},control:e.jsx(O,{checked:_,onClick:n=>{V(!_),n.preventDefault(),n.stopPropagation()},color:"primary",disabled:!0}),label:""})}),e.jsx(P,{value:H,onChange:n=>{Q(n.target.value)},label:"Email",placeholder:"example@domain.com",fullWidth:!0,disabled:!0,sx:{"& input":{height:"8px",minHeight:"unset"}}})]}),!s.cron.mailEnabled&&e.jsx(j,{children:e.jsx(B,{children:"Mail server not available. Configure in Settings > Mail."})}),e.jsxs(d,{sx:{marginTop:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{children:"Add attachment"}),e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"9px"},control:e.jsx(O,{checked:N,onClick:n=>{U(!N),n.preventDefault(),n.stopPropagation()},color:"primary",disabled:!0}),label:"CSV"})}),e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"9px"},control:e.jsx(O,{checked:F,onClick:n=>{G(!F),n.preventDefault(),n.stopPropagation()},color:"primary",disabled:!0}),label:"JSON"})}),e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"9px"},control:e.jsx(O,{checked:M,onClick:n=>{J(!M),n.preventDefault(),n.stopPropagation()},color:"primary",disabled:!0}),label:"XML"})})]}),e.jsx(j,{children:e.jsx(B,{children:"Adds query results as attachments in the given formats."})})]})]}),e.jsx(d,{sx:{"& label":{marginTop:0}},children:e.jsx(ss,{})})]})}),e.jsx(xe,{sx:{padding:0},children:e.jsxs(d,{sx:{width:"100%",margin:"10px 25px 30px 25px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[e.jsx(L,{autoFocus:!0,fullWidth:!0,variant:"contained",onClick:n=>{n.stopPropagation()},disabled:!0,children:"Schedule"}),e.jsx(L,{fullWidth:!0,variant:"outlined",onClick:n=>{x(!1),n.stopPropagation()},children:"Cancel"})]})})]})},gs=a.lazy(()=>te(()=>import("./QueryParams-1.0.43-Bh_wwBTE.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url)),js=a.lazy(()=>te(()=>import("./QuerySchedules-1.0.43-CDaSQbc1.js"),__vite__mapDeps([38,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,20,21,22,23,39,19,17,18,40,41,42,31,25,43,44,45,46,47,48,36,34,49,50,51,26,35,24,27,28,52,53,32,33,54,55,56,57,58,59,60,61,29,30,62,63,37,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78]),import.meta.url)),bs=a.lazy(()=>te(()=>import("./QueryBuilder-1.0.43-DowaLN4B.js").then(r=>r.g),__vite__mapDeps([45,19,1,2,3,9,10,11,12,15,7,8,13,16,6,14,17,18,39,40,41,42,31,25,4,5,46,47,48,36,34,23,49,50,51,26,35,24,27,28,52,53,32,33,22,54,55,56,57,58,59,60,61]),import.meta.url)),vs=a.lazy(()=>te(()=>import("./AiAssistant-1.0.43-CBOol-c4.js"),__vite__mapDeps([79,19,1,2,3,9,10,11,12,6,7,8,13,14,15,16,41,64,31,24,25,26,27,80,81,82,68,32,33,28,34,23,35,22,36,54,4,5,39,17,18,40,42,83,84,74]),import.meta.url)),Cs=({queries:r,queryKey:s,databases:y,setQueryResults:x})=>{var he;const l=re(),i=Xe(),g=a.useRef(null),[A,c]=a.useState(null),S=!!A,[h,k]=a.useState(!0),[v,p]=a.useState(100),[f,o]=a.useState(!1),[C,_]=a.useState(!1),[V,H]=a.useState(!1),[Q,N]=a.useState(""),[U,F]=a.useState(!1),[G,M]=a.useState(!1),[J,W]=a.useState(!1),[X,z]=a.useState(!1),[Y,n]=a.useState(!1),[T,$]=a.useState(!1),[Ae,ue]=a.useState(!1),me=async()=>{if(Y)M(!0);else try{await cs(Ye.appUrlAiEnabled,{}).then(t=>{var Z,R,E,q,fe;m.debug(t),((Z=t==null?void 0:t.data)==null?void 0:Z.code)==="ok"&&((E=(R=t==null?void 0:t.data)==null?void 0:R.data)==null?void 0:E.enabled)===!0?(M(!0),n(!0)):(W(!0),$(((fe=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:fe.encryption)===!0))}).catch(t=>{m.error(t)})}catch(t){m.error(t)}};return a.useEffect(()=>{i.openAI&&i.openAI.prompt!==void 0&&i.openAI.queryKey===s&&me()},[i.openAI]),e.jsxs(e.Fragment,{children:[e.jsx(De,{position:"relative",sx:{margin:"0 0 5px 0",borderRadius:"4px"},children:e.jsxs(we,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsx(I,{title:"Choose the database to run your query against",placement:"top",children:e.jsx(j,{children:e.jsxs(Te,{value:r[s].schemaName,MenuProps:{id:"pp-select-database"},size:"small",sx:{width:"250px",backgroundColor:"#fff"},onChange:t=>{l(ge({queryKey:s,query:{...r[s],schemaName:t.target.value}}))},children:[...y.databases.map(t=>e.jsx(u,{value:t.dbs,sx:{width:"250px"},children:t.dbs},t.dbs))]})})}),e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(I,{title:"Set a maximum number of rows to retrieve",children:e.jsxs(d,{sx:{display:"flex",justifyContent:"start"},children:[e.jsx(j,{children:e.jsx(D,{sx:{marginRight:"9px"},control:e.jsx(O,{checked:h,onClick:t=>{k(!h),t.preventDefault(),t.stopPropagation()},color:"secondary",sx:{"& svg":{fill:"#fff"}}}),label:"Max rows: "})}),e.jsx(Se,{customInput:P,value:v,disabled:!h,variant:"outlined",onValueChange:({value:t})=>{p(Number(t))},onInvalid:t=>{t.preventDefault()},sx:{"& input.MuiInputBase-input":{borderRadius:"4px",height:"8px",backgroundColor:"#fff",width:"55px",minHeight:"unset"},"& fieldset":{borderRadius:"4px"}}})]})}),e.jsx(I,{title:"Execute query",children:e.jsx(K,{sx:{color:"inherit",marginLeft:"8px"},onClick:()=>{o(!0),Je(i.queries[s].schemaName,ae(i.queries[s].query),h?v.toString():"",i.protectWordPressTables,i.queries[s].params,t=>{m.debug(t),(t==null?void 0:t.code)==="ok"&&t.data?x(t.data):(m.error("Invalid response"),b("Invalid response",{variant:"error"})),o(!1)},t=>{m.error(t),b(t,{variant:"error"}),o(!1)})},children:f?e.jsx(d,{sx:{"& span.MuiCircularProgress-root":{width:"20px !important",height:"20px !important"},"& svg":{color:"#fff"}},children:e.jsx(Ze,{})}):e.jsx(Me,{})})}),e.jsx(a.Suspense,{children:e.jsx(gs,{queryKey:s,queryBuilderState:i})}),e.jsx(a.Suspense,{children:e.jsx(js,{queryKey:s,queryBuilderState:i})})]})]}),e.jsxs(d,{sx:{display:"flex",flexDirection:"row"},children:[e.jsx(I,{title:"Save query",children:e.jsx(K,{sx:{color:"inherit"},onClick:()=>{ye(i.queries[s].access,i.queries[s].schemaName,i.queries[s].queryName,ae(i.queries[s].query),!1,"",i.queries[s].isInserting,i.queries[s].params,t=>{m.debug(t),(t==null?void 0:t.code)==="ok"&&(l(ge({queryKey:s,query:{...i.queries[s],isInserting:void 0},isUpdated:!1})),b("Query succesfully saved",{variant:"success"}))},t=>{m.error(t),b(t,{variant:"error"})})},children:e.jsx(Ve,{})})}),e.jsx(I,{title:"AI Assistant",children:e.jsx(K,{onClick:async()=>{me()},sx:{color:"inherit"},children:e.jsx(ze,{})})}),e.jsx(I,{title:"More actions",children:e.jsx(K,{sx:{color:"inherit",padding:0},onClick:t=>{c(t.currentTarget),t.stopPropagation()},children:e.jsx(Re,{})})}),e.jsxs(ps,{anchorEl:A,open:S,onClose:()=>c(null),sx:{zIndex:9999999999},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(u,{onClick:()=>{c(null),_(!0)},disabled:r[s].isInserting===!0,children:[e.jsx(Ee,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy query"})]}),e.jsxs(u,{onClick:()=>{c(null),H(!0)},children:[e.jsx(Oe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Rename query"})]}),e.jsxs(u,{onClick:()=>{c(null),F(!0)},sx:{color:(he=w)==null?void 0:he.palette.error.main},disabled:r[s].isInserting===!0,children:[e.jsx(Le,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Delete query"})]}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{c(null),ue(!0)},disabled:r[s].isInserting===!0,children:[e.jsx(_e,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Schedule query"})]}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{g.current!==null&&g.current.click()},children:[e.jsx(Qe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Load from file"}),e.jsx("input",{ref:g,type:"file",onChange:t=>{if(t.target.files!==null){const Z=t.target.files[0];let R=new FileReader;R.onload=E=>{const q=E.target.result;l(Be({copyQuery:q}))},R.onerror=E=>alert(E.target.error.name),R.readAsText(Z)}},style:{height:0,width:0}})]}),e.jsxs(u,{onClick:()=>{ds(new Blob([r[s].query],{type:"text/sql;charset=utf-8"}),r[s].queryName+".sql")},children:[e.jsx(Ne,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Save to file"})]}),e.jsx($e,{text:r[s].query,onCopy:()=>{b("Query successfully copied to clipboard",{variant:"info"}),c(null)},children:e.jsxs(u,{children:[e.jsx(xs,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Copy to clipboard"})]})}),e.jsx(u,{divider:!0,sx:{margin:"8px 0",padding:0}}),e.jsxs(u,{onClick:()=>{l(ie({queryKey:s}))},children:[e.jsx(Fe,{}),e.jsx("span",{style:{marginLeft:"10px"},children:"Close query"})]})]})]})]})}),e.jsx(us,{queries:r,queryKey:s,copyDialog:C,setCopyDialog:_,newName:Q,setNewName:N}),e.jsx(ms,{queries:r,queryKey:s,renameDialog:V,setRenameDialog:H,newName:Q,setNewName:N}),e.jsx(hs,{queries:r,queryKey:s,confirmDelete:U,setConfirmDelete:F}),e.jsx(ke,{title:"AI Assistant",message:e.jsx(d,{sx:{maxWidth:"430px"},children:"The AI Assistant is not yet enabled for your account. To start using it, you'll need to enter a valid API key. Would you like to configure the AI Assistant now?"}),open:J,setOpen:W,onConfirm:()=>{z(!0)}}),e.jsx(fs,{queryKey:s,queryBuilderState:i,scheduling:Ae,setScheduling:ue,limit:h?v.toString():""}),e.jsx(a.Suspense,{children:e.jsx(bs,{open:X,setOpen:z,encryption:T})}),e.jsx(a.Suspense,{children:e.jsx(vs,{queryKey:s,open:G,setOpen:M})})]})},at=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"}));export{fs as D,at as Q};
